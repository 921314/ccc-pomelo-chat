{"version":3,"sources":["ChatListViewCtrl.js"],"names":["Utils","require","RoomInfo","cc","Class","extends","Component","properties","itemTemplate","default","type","Node","scrollView","ScrollView","chatRoot","totalCount","spacing","lastItem","btnAddItem","Button","btnRemoveItem","itemScript","onLoad","content","items","initialize","updateTimer","updateInterval","lastContentPosY","curCount","height","getPositionInView","item","worldPos","parent","convertToWorldSpaceAR","position","viewPos","node","convertToNodeSpaceAR","addItem","info","i","instantiate","addChild","setPosition","log","comp","getComponentInChildren","updateItem","push","removeItem","pop","removeChild","addOneItem","sender","msg","tmp","chatLogs","refreshList","subOneItem","len","length","scrollToFixedPosition","scrollToOffset","p","logList","active","self"],"mappings":"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","file":"ChatListViewCtrl.js","sourceRoot":"../../../../../assets/Script/ui","sourcesContent":["var Utils = require('Utils')\nvar RoomInfo = require('RoomInfo')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemTemplate: { // item template to instantiate other items\n            default: null,\n            type: cc.Node\n        },\n        scrollView: {\n        \tdefault: null,\n        \ttype: cc.ScrollView\n        },\n        chatRoot: {\n            default: null,\n            type: cc.Node,\n        },\n        totalCount: 0, \n        spacing: 0, \n        lastItem: null,\n        btnAddItem: cc.Button,\n        btnRemoveItem: cc.Button,\n        itemScript: \"ChatItem\",\n    },\n\n    // use this for initialization\n    onLoad: function () {\n    \tthis.content = this.scrollView.content;\n        this.items = []; // array to store spawned items\n    \tthis.initialize();\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosY = 0; // use this variable to detect if we are scrolling up or down\n        this.curCount = 0;\n    },\n\n    initialize: function () {\n        this.content.height = this.totalCount * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n    },\n\n    getPositionInView: function (item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    },\n\n    addItem: function(info) {\n        let i = this.curCount + 1;\n        let item = cc.instantiate(this.itemTemplate);\n        this.content.addChild(item);\n        item.setPosition(0, -item.height * (0.5 + i - 1) - this.spacing * (i + 1));\n        cc.log(-item.height * (0.5 + i) - this.spacing * (i + 1));\n        var comp = item.getComponentInChildren(this.itemScript);\n        if (comp) {\n            comp.updateItem(info);\n        }\n        this.items.push(item);\n        \n        this.curCount = this.curCount + 1\n        this.content.height = (this.curCount) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.curCount\n    },\n\n    removeItem: function() {\n        if (this.curCount <= 0) {\n            return;\n        }\n        let i = this.curCount;\n        let item = this.items.pop();\n        this.content.removeChild(item);\n\n        this.curCount = this.curCount - 1;\n        this.content.height = (this.curCount) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.curCount\n    },\n\n    addOneItem: function(sender, msg) {\n        cc.log(\"addOneItem\", sender, msg)\n        var tmp = {};\n        if (msg) {\n            tmp.msg = msg;\n        } else {\n            tmp.msg = \"?>!!?!?!?!?!??!\";\n        }\n        RoomInfo.chatLogs.push(tmp);\n        this.refreshList()\n    },\n\n    subOneItem: function() {\n        var len = RoomInfo.chatLogs.length;\n        RoomInfo.chatLogs.pop();\n        \n        this.refreshList()\n    },\n\n    scrollToFixedPosition: function () {\n        this.scrollView.scrollToOffset(cc.p(0, 500), 2);\n    },\n\n    refreshList: function() {\n        var logList = RoomInfo.chatLogs;\n        for (i = 0; i < this.items.length; i++) {\n            var item = this.items[i];\n            item.active = false;\n        }\n        this.items = [];\n        this.curCount = 0;\n        this.totalCount = 0;\n        var self = this;\n        \n        for (i = 0; i < logList.length; i++) {\n            var info = logList[i];\n            if (!this.items[i]) {\n                this.addItem(info);\n            } else {\n                var comp = this.items[i].getComponentInChildren(self.itemScript)\n                if (comp) {\n                    comp.updateItem(info);\n                }                \n                this.items[i].active = true;\n            }\n        }\n    }\n});\n"]}