{"version":3,"sources":["../../../../../assets/Script/ui/assets/Script/ui/ListViewCtrl.js"],"names":["RoomInfo","require","cc","Class","extends","Component","properties","itemTemplate","default","type","Node","scrollView","ScrollView","chatRoot","totalCount","spacing","lastItem","btnAddItem","Button","btnRemoveItem","onLoad","content","items","initialize","updateTimer","updateInterval","lastContentPosY","curCount","height","getPositionInView","item","worldPos","parent","convertToWorldSpaceAR","position","viewPos","node","convertToNodeSpaceAR","addItem","name","i","instantiate","addChild","setPosition","log","comp","getComponentInChildren","updateItem","push","removeItem","pop","removeChild","addOneItem","len","players","length","tmp","refreshList","subOneItem","scrollToFixedPosition","scrollToOffset","p","active","self","cb","sender","getID","getName","interactable","setEnabled","targetName","getComponent","setTargetName","setClickCallback"],"mappings":"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","file":"ListViewCtrl.js","sourceRoot":"../../../../../assets/Script/ui","sourcesContent":["var RoomInfo = require('RoomInfo')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemTemplate: { // item template to instantiate other items\n            default: null,\n            type: cc.Node\n        },\n        scrollView: {\n        \tdefault: null,\n        \ttype: cc.ScrollView\n        },\n        chatRoot: {\n            default: null,\n            type: cc.Node,\n        },\n        totalCount: 0, \n        spacing: 0, \n        lastItem: null,\n        btnAddItem: cc.Button,\n        btnRemoveItem: cc.Button,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n    \tthis.content = this.scrollView.content;\n        this.items = []; // array to store spawned items\n    \tthis.initialize();\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosY = 0; // use this variable to detect if we are scrolling up or down\n        this.curCount = 0;\n    },\n\n    initialize: function () {\n        this.content.height = this.totalCount * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n    },\n\n    getPositionInView: function (item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    },\n\n    addItem: function(name) {\n        let i = this.curCount + 1;\n        let item = cc.instantiate(this.itemTemplate);\n        this.content.addChild(item);\n        item.setPosition(0, -item.height * (0.5 + i - 1) - this.spacing * (i + 1));\n        cc.log(-item.height * (0.5 + i) - this.spacing * (i + 1));\n        var comp = item.getComponentInChildren('Item');\n        if (comp) {\n            comp.updateItem(i, name);\n        }\n        this.items.push(item);\n        \n        this.curCount = this.curCount + 1\n        this.content.height = (this.curCount) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.curCount\n    },\n\n    removeItem: function() {\n        if (this.curCount <= 0) {\n            return;\n        }\n        let i = this.curCount;\n        let item = this.items.pop();\n        this.content.removeChild(item);\n\n        this.curCount = this.curCount - 1;\n        this.content.height = (this.curCount) * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.totalCount = this.curCount\n    },\n\n    addOneItem: function() {\n        var len = RoomInfo.players.length;\n        cc.log(\"addOneItem\", len)\n        var tmp = {};\n        tmp.name = \"name\" + (len + 1);\n        RoomInfo.players.push(tmp);\n        this.refreshList()\n    },\n\n    subOneItem: function() {\n        var len = RoomInfo.players.length;\n        cc.log(\"subOneItem\", len)\n        RoomInfo.players.pop();\n        \n        this.refreshList()\n    },\n\n    scrollToFixedPosition: function () {\n        this.scrollView.scrollToOffset(cc.p(0, 500), 2);\n    },\n\n    refreshList: function() {\n        cc.log('refreshList', RoomInfo.players.length, this.items.length);\n        for (i = 0; i < this.items.length; i++) {\n            // this.items[i].visivle = false;\n            // this.content.removeChild(this.items[i]);\n            var item = this.items[i];\n            item.active = false;\n        }\n        this.items = [];\n        this.curCount = 0;\n        this.totalCount = 0;\n        var self = this;\n        var cb = function(sender) {\n            cc.log(sender.getID(), sender.getName(), sender.interactable);\n            if (self.lastItem) {\n                self.lastItem.setEnabled(true);\n            }\n            sender.setEnabled(false);\n            self.lastItem = sender;\n\n            RoomInfo.targetName = sender.getName();\n            self.chatRoot.getComponent(\"Chat\").setTargetName(sender.getName());\n        }\n        for (i = 0; i < RoomInfo.players.length; i++) {\n            var name = RoomInfo.players[i].name;\n            cc.log(name, this.items[i]);\n            if (!this.items[i]) {\n                this.addItem(name);\n                var comp = this.items[i].getComponentInChildren('Item');\n                if (comp) {\n                    comp.setClickCallback(cb);\n                }\n            } else {\n                var comp = this.items[i].getComponentInChildren('Item')\n                if (comp) {\n                    comp.updateItem(i + 1, name);\n                }                \n                this.items[i].active = true;\n            }\n        }\n    }\n});\n"]}